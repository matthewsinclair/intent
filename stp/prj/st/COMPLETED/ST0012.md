---
verblock: "06 Mar 2025:v0.1: Matthew Sinclair - Initial version"
stp_version: 1.2.0
status: Completed
created: 20250307
completed: 20250307
---
# ST0012: Document Sync Command

- **Status**: Completed
- **Created**: 2025-03-07
- **Completed**: 2025-03-07
- **Author**: Matthew Sinclair

## Objective

Create a new `stp st sync` command that will maintain the steel_threads.md document by synchronizing it with the current state of individual steel thread files.

## Context

Currently, the `stp/prj/st/steel_threads.md` document needs to be manually kept in sync with the individual ST####.md files. The `stp st list` command now reads directly from the ST files, but the summary document needs to be updated separately.

This causes inconsistencies when steel thread status changes or when new steel threads are added. A mechanism is needed to ensure the summary document accurately reflects the current state of all steel threads.

## Approach

1. Create a new `sync` option in the `stp_st` script
2. Add support for section markers in the steel_threads.md document
3. Read metadata from each ST####.md file
4. Generate updated content for the marked sections in steel_threads.md
5. Either output the updated content to stdout or write it to the file based on options

## Tasks

- [x] Add section markers to the steel_threads.md document
- [x] Create a new `sync` subcommand in the `stp_st` script
- [x] Implement logic to extract metadata from ST files
- [x] Add functionality to update sections between markers
- [x] Add `--write` option for file updates
- [x] Add `--width` option for configurable table formatting
- [x] Add documentation for the new command
- [x] Update tests to ensure proper functionality

## Implementation Notes

The implementation uses section markers in the form of HTML-like comments to identify the parts of the document that should be updated:

```
<!-- BEGIN: STEEL_THREAD_INDEX -->
(content will be replaced during sync)
<!-- END: STEEL_THREAD_INDEX -->
```

This allows for automatic updates to specific sections while preserving the rest of the document.

### Key Implementation Details

1. **New `sync` Command**: Added a new `sync` subcommand to the `stp_st` script that reads the individual steel thread files and updates the steel_threads.md document.

2. **Metadata Extraction**: The command extracts metadata (status, created date, completed date) from individual ST####.md files using both:
   - Metadata in the YAML frontmatter (with keys `status`, `created`, and `completed`)
   - Information in the document body (with lines like `- **Status**: In Progress`)

3. **Section Markers**: Added HTML-style comment markers to designate sections in the steel_threads.md file that can be automatically updated.

4. **Configurable Output**: Added options to customize the output:
   - `--write`: Updates the steel_threads.md file directly
   - `--width N`: Specifies the width of the output table for proper column alignment
   
5. **Format Consistency**: Ensures proper table formatting and column alignment for better readability.

This approach makes the system more maintainable by ensuring the steel_threads.md document stays in sync with the individual ST files, reducing manual maintenance work.

## Results

The Document Sync Command feature was successfully implemented, providing the following benefits:

1. **Automated Consistency**: The steel_threads.md document is now automatically kept in sync with the individual steel thread files, eliminating manual updates and ensuring consistency.

2. **Configurable Output**: The command supports customizable table widths to ensure proper formatting for both terminal output and document integration.

3. **Metadata Support**: The implementation handles both YAML frontmatter and document body metadata, providing flexibility in how steel thread information is stored.

4. **Non-Destructive Updates**: The section marker approach allows for updating specific parts of the document while preserving manually edited sections.

5. **Comprehensive Tests**: Added test cases ensure the feature works correctly and will continue to function after future changes.

The sync command provides a significant improvement in the maintainability of the STP documentation system by automating what was previously a manual process. This reduces the likelihood of documentation inconsistencies and saves time when managing steel threads.

## Related Steel Threads

- [List any related steel threads here]

## Context for LLM

This document represents a single steel thread - a self-contained unit of work focused on implementing a specific piece of functionality. When working with an LLM on this steel thread, start by sharing this document to provide context about what needs to be done.

### How to update this document

1. Update the status as work progresses
2. Check off tasks as they are completed
3. Add implementation notes as decisions are made or challenges encountered
4. Add results when the steel thread is completed
5. Mark the completion date when finished

The LLM should assist with implementation details and help maintain this document as work progresses.
